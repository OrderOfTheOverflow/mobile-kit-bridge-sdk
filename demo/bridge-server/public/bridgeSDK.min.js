!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).bridgeSDK={})}(this,function(e){"use strict";function t(e){return[...Object.keys(e),...Object.getOwnPropertyNames(Object.getPrototypeOf(e))]}function n({moduleName:e,funcName:t,requestID:n}){return`${e}_${t}Callback${null!==n?`_${n}`:""}`}function r(e,...n){const r=t(e);return!!e&&n.every(e=>r.indexOf(e)>=0)}function c(e){return`Wrapped${e}`}function o(t,{callbackNameFunc:n,funcToWrap:c}){return{subscribe:o=(o=>{const u=n();let a;return t[u]=(t=>{if(r(t,"status_code"))if(r(t.result,"event"))switch(t.result.event){case e.StreamEvent.STREAM_TERMINATED:a.unsubscribe()}else o&&o.next&&o.next(t)}),c(u)(),a=function(e){let t=!1;return{isUnsubscribed:()=>t,unsubscribe:()=>{t||(e(),t=!0)}}}(()=>{delete t[u],o&&o.complete&&o.complete()})}),then:e=>new Promise(()=>{const t=o({next:n=>{e&&e(n),t.unsubscribe()}})})};var o}function u(e,t){var{funcNameToWrap:n,isStream:r}=t,c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var c=0;for(r=Object.getOwnPropertySymbols(e);c<r.length;c++)t.indexOf(r[c])<0&&(n[r[c]]=e[r[c]])}return n}(t,["funcNameToWrap","isStream"]);return r?o(e,c):function(e,{callbackNameFunc:t,funcToWrap:n}){const r=t();return new Promise(t=>{e[r]=(n=>{t(n),delete e[r]}),n(r)()})}(e,c)}(e.StreamEvent||(e.StreamEvent={})).STREAM_TERMINATED="STREAM_TERMINATED",e.wrapModule=function(e,r){if(e[r]){const o=e[r],a=function(e,r,c){const o=t(c).filter(e=>"function"==typeof c[e]).map(t=>{let o=0;const a=()=>{const e=`${o}`;return o+=1,n({moduleName:r,requestID:e,funcName:t})};return{[t]:n=>u(e,{callbackNameFunc:a,funcNameToWrap:t,isStream:n.isStream,funcToWrap:e=>c[t].bind(c,JSON.stringify({callback:e,method:t,parameters:n}))})}}).reduce((e,t)=>Object.assign({},e,t),{});return{invoke:(e,t)=>o[e](t)}}(window,r,o);e[c(r)]=a}else if(e.webkit&&e.webkit.messageHandlers&&e.webkit.messageHandlers[r]){const t=function(e,t,r){const c={};return{invoke:(o,a)=>u(e,{funcNameToWrap:o,isStream:a.isStream,callbackNameFunc:()=>{const e=c[o]||0;return c[o]=e+1,n({moduleName:t,requestID:e,funcName:o})},funcToWrap:e=>r.postMessage.bind(r,{callback:e,method:o,parameters:a})})}}(e,r,e.webkit.messageHandlers[r]);e[c(r)]=t}},Object.defineProperty(e,"__esModule",{value:!0})});