"use strict";function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&(r[n[a]]=e[n[a]])}return r}function createSubscription(e){let t=!1;return{isUnsubscribed:()=>t,unsubscribe:()=>{t||(e(),t=!0)}}}function createDataStream(e){return{subscribe:e,then:t=>new Promise(()=>{const r=e({next:e=>{t&&t(e),r.unsubscribe()}})})}}function getObjectKeys(e){return[...Object.keys(e),...Object.getOwnPropertyNames(Object.getPrototypeOf(e))]}function getCallbackName({moduleName:e,funcName:t,requestID:r}){return`${e}_${t}Callback${null!==r?`_${r}`:""}`}function isType(e,...t){const r=getObjectKeys(e);return!!e&&t.every(e=>r.indexOf(e)>=0)}function wrapModuleName(e){return`Wrapped${e}`}function promisifyCallback(e,{callbackNameFunc:t,funcToWrap:r}){const n=t();return new Promise(t=>{e[n]=(r=>{t(r),delete e[n]}),r(n)})}function streamCallback(e,{callbackNameFunc:t,funcToWrap:r}){return createDataStream(n=>{const a=t();let c;return e[a]=(e=>{if(isType(e,"status_code"))if(isType(e.result,"event"))switch(e.result.event){case exports.StreamEvent.STREAM_TERMINATED:c.unsubscribe()}else n&&n.next&&n.next(e)}),r(a),c=createSubscription(()=>{delete e[a],n&&n.complete&&n.complete()})})}function simplifyCallback(e,t){var{funcNameToWrap:r,isStream:n}=t,a=__rest(t,["funcNameToWrap","isStream"]);return n?streamCallback(e,a):promisifyCallback(e,a)}function wrapGenericModule(e,t,r){const n={};return{invoke:(a,c)=>simplifyCallback(e,{funcNameToWrap:a,isStream:!!c&&!!c.isStream,callbackNameFunc:()=>{const e=n[a]||0;return n[a]=e+1,getCallbackName({moduleName:t,requestID:e,funcName:a})},funcToWrap:e=>r({callback:e,method:a,parameters:null!=c?c:{}})})}}function wrapModule(e,t){e[wrapModuleName(t)]=wrapGenericModule(e,t,r=>{e[t]?e[t][r.method](JSON.stringify(r)):e.webkit&&e.webkit.messageHandlers&&e.webkit.messageHandlers[t]&&e.webkit.messageHandlers[t].postMessage(r)})}Object.defineProperty(exports,"__esModule",{value:!0}),(exports.StreamEvent||(exports.StreamEvent={})).STREAM_TERMINATED="STREAM_TERMINATED",exports.wrapModule=wrapModule;